<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>Add Tomo</title>
	<link rel="stylesheet" href="../style.css">
</head>

<body>
	<h1><tt>relion_tomo_add_tomo</tt></h1>
	
	<p>This program adds a new tilt series to a <a href="../data_types/tomogram_set.html">tomogram set</a>. It is typically the first program to be used to create a Relion tomography data set. It imports an existing alignment from <a href="https://bio3d.colorado.edu/imod/">IMOD</a> and the initial CTF parameters from either <a href="https://grigoriefflab.umassmed.edu/ctffind4">CTFFind</a> or <a href="https://bio3d.colorado.edu/imod/doc/man/ctfplotter.html">CtfPlotter</a>. Additional parameters, such as the fractional electron dose and the chronological sequence of frames have to be supplied through the command line. The default parameters correspond to default IMOD output file names, so they can be omitted if the program is pointed to an IMOD project directory (<tt>--id</tt> argument).</p>
	
	<p>The tilt series alignment effectively defines an arbitrary 3D coordinate system, as well as a set of projections that map those 3D coordinates to the individual 2D images of the tilt series. The aim of this program is to translate that alignment into the Relion nomenclature. If used successfully, this will produce an equivalent 3D coordinate system inside Relion that will allow particle positions already defined in an IMOD tomogram to be used unchanged.</p>

	<p>Optimally, the tilt series would be imported into Relion right after alignment, and the particles would be picked in a low-magnification tomogram generated by <a href="reconstruct_tomogram.html"><tt>relion_tomo_reconstruct_tomogram</tt></a>. That way, the particle positions would be guaranteed to be correct.</p>
	
	<p>Note: the user is advised to call this program from a script, inside a loop running over all tilt series.</p>
	
		
	<h3>General program arguments:</h3>
	
	<ul>		
		<li><b>--ts</b>: tilt-series file name, typically an <tt>.st</tt> file. Note: since <tt>.st</tt> files are really <tt>.mrc</tt> files, these should be specified as <tt>&lt;name&gt;.st:mrc</tt> to tell Relion to read them as such.</li>
		<li><b>--name</b>: the <tt>tomo_name</tt> chosen for this tilt series (see <a href="../data_types/tomogram_set.html">tomogram set</a>). If absent, it will be named <tt>ts_&lt;N&gt;</tt>, where <tt>&lt;N&gt;</tt> is the next available integral number. The user is strongly advised to name tomograms the same as the original IMOD directory to prevent confusion.</li>
		<li><b>--hand</b>: the handedness of the tilt geometry. The value of this parameter is either +1 or -1, and it describes whether the focus increases or decreases as a function of Z distance. It has to be determined experimentally. In our experiments, it has always been -1.</li>
		<li><b>--io</b>: the input <i>and</i> output <a href="../data_types/tomogram_set.html">tomogram set</a>. The current tilt series will be added to the existing set, and the existing set will be overwritten.</li>
		<li><b>--oc</b>: output file name for a culled stack. In case images have been excluded inside IMOD (using the <tt>EXCLUDE</tt>, <tt>EXCLUDELIST</tt> or <tt>EXCLUDELIST2</tt> commands), a new tilt series with those images missing will be written to that file.</li>
	</ul>
	
	
	<h3>Optics arguments:</h3>
	
	<ul>
		<li><b>--ctffind</b> or <b>--ctfplotter</b>: the output file from either CTFFind or CtfPlotter, specifying the initial defocus and astigmatism values of each frame.</li>
		<li><b>--angpix</b>: the pixel size in &#8491;.</li>
		<li><b>--voltage</b>: the voltage in kV.</li>
		<li><b>--Cs</b>: the spherical aberration in mm.</li>
		<li><b>--Q0</b>: the amplitude constrast.</li>
	</ul>
	
	
	<h3>Electron dose arguments:</h3>
	
	<ul>
		<li><b>--ol</b>: the file name of a frame-order list file. This is a file containing two numbers per line separated by a comma (and no spaces), where the first number counts up from 1, while the second describes the <i>chronological</i> sequence of tilt angles. This is needed to associate the frames of the tilt series with the order in which they were collected. Specifically, each frame is associated with the line in the frame-order file that shows the closest tilt angle to the tilt angle of that frame (as stored in the <tt>.tlt</tt> file).</li>
		<li><b>--tlt</b>: a list of tilt angles of each frame. If omitted, the corresponding <tt>.tlt</tt> file from the IMOD directory will be used.</li>
		<li><b>--fd</b>: The fractional (i.e. per tilt-image) electron dose.</li>
	</ul>
	
	
	<h3>IMOD import arguments:</h3>
	
	<ul>
		<li><b>--id</b>: the path to the IMOD directory corresponding to this tilt series. That directory has to contain the command files used to run IMOD's <tt>tilt</tt> and <tt>newst</tt> programs. Typically, those are named <tt>tilt.com</tt> and <tt>newst.com</tt>. If those are not their names, then the actual names can be specified using the <b>--tc</b> and <b>--nc</b> arguments, respectively. Additional IMOD files that are referenced inside those <tt>.com</tt> files also need to be present inside the IMOD directory.</li>
		<li><b>--flipYZ</b>: if the IMOD tomogram has been flipped along Y and Z (i.e. rotated around X) after an IMOD reconstruction and before the particles have been picked, this will apply the same transformation to the Relion coordinate system. This will allow Relion to use particle positions defined in the X-rotated tomogram unchanged.</li>
		<li><b>--flipZ</b>: same as above, in case the Z axis has been flipped. This can be used together with the <tt>--flipYZ</tt> option.</li>
		<li><b>--flipAng</b>: indicates that all angles in the IMOD <tt>.tlt</tt> file have also been flipped. This is rare.</li>
		<li><b>--off&lt;x/y/z&gt;</b>: applies an offset to the 3D coordinate system, in case the IMOD tomogram has been cropped after reconstruction and before particle picking. Note: if the coordinates have been shifted inside IMOD's <tt>tilt.com</tt> using the <tt>SHIFT</tt> command, then that shift will be handled internally and does not need to be specified here.</li>
	</ul>
		
		
	<p>Final note: not all IMOD options are supported by this program. For example, the X-axis tilt option is not supported. In case it has been used, we recommend ignoring it and refining the resulting alignment using the program <a href="align_frames.html"><tt>relion_tomo_align_frames</tt></a>.</p>
	
	
</body>

</html>
